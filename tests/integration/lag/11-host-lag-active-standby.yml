message: |
  The device under test is a pair of switches with a pair of links connected to 2 Linux hosts.
  The Linux hosts are using active-standby lags, which don't require any special support from the switches

  The hosts should be able to ping each other and their gateway

plugin: [bonding]

groups:
  _auto_create: true
  switches:
    members: [s1, s2]
    module: [vlan]      # No 'lag' module support enabled
  hosts:
    members: [h1, h2]
    device: linux

vlans:
  red:
    mode: bridge
    # links: [h1-s1,h2-s2] # Case with bond should be the same as without

links:
- s1:
  s2:
  vlan.trunk: [red]
- lag:
    members: [h1-s1, h1-s2]
  vlan.access: red
- lag:
    members: [h2-s1, h2-s2]
  vlan.access: red

validate:
  ping:
    description: Pinging H2 from H1
    nodes: [h1]
    wait_msg: Waiting for STP to enable the ports
    wait: 45
    plugin: ping('h1',af='ipv4')
  ping_gw:
    description: Pinging gateway from H1
    nodes: [h1]
    plugin: ping(nodes.s1.interfaces[-1].ipv4,af='ipv4')
