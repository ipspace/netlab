---
message: |
  The devices under test are a pair of routers with a L3 LAG link between them
  h1 and h2 should be able to ping each other
groups:
  _auto_create: True
  hosts:
    members: [ h1, h2 ]
    device: linux
    provider: clab
  switches:
    members: [ r1,r2,r3 ]
    module: [ lag, ospf ]

links:
- group: lag1_2
  type: lag
  members: [r1-r2,r1-r2]
- group: lag2_3
  type: lag
  lag.ifindex: 0 # Name it as 'bond0' -> First one becomes 'bond1'
  members: 
  - r2:
      ifindex: 3
    r3:
      ifindex: 3
  - r2:
      ifindex: 4
    r3:
      ifindex: 4
- h1-r1
- r3-h2

validate:
  ping:
    description: Pinging H2 from H1
    nodes: [ h1 ]
    wait_msg: Waiting for STP to enable the ports
    wait: 45
    plugin: ping('h2')