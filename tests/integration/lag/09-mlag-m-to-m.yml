---
message: |
  The device under test are two pairs of switches, interconnected through dual-sided MLAG links
  The hosts should be able to ping each other and their gateway

groups:
  _auto_create: True
  switches:
    members: [ a1, a2, b1, b2 ]
    module: [ lag, vlan ]
    device: eos
  hosts:
    members: [ h1, h2 ]
    module: [ lag ]     # Host side must support lag to present single MAC on both interfaces
    device: frr         # linux does not support 'lag' module yet

vlans:
  red:
   links: [a1-h1, b2-h2]

links:
- lag:
   members: [ a1-a2 ]
   mlag.peergroup: 1
- lag:
   members: [ b1-b2 ]
   mlag.peergroup: 2
- lag:
   mlag: True
   members:
   - a1:
     b1:
   - a2:
     b2:
  vlan.trunk: [red]

validate:
  ping:
    description: Pinging H2 from H1
    nodes: [ h1 ]
    wait_msg: Waiting for STP to enable the ports
    wait: 45
    plugin: ping(nodes.h2.interfaces[0].ipv4,af='ipv4')
  ping_gw:
    description: Pinging gateway from H1
    nodes: [ h1 ]
    plugin: ping(nodes.s1.interfaces[8].ipv4,af='ipv4')
