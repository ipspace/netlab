message: |
  This lab builds 3 L2 domains with IRB (VLAN 1000-1002) across three PE-routers running
  EVPN with MPLS transport. All hosts connected to VLANs 1000-1002 (h1-h4) should be
  able to ping each other.

defaults.device: eos

bgp.as: 65000

vrfs:
  tenant:
    evpn.mode: "symmetric_irb" # MPLS has no transit_vni

vlans:
  red:
    mode: irb
    vrf: tenant
  green:
    mode: irb
    vrf: tenant
  blue:
    mode: irb
    vrf: tenant

# evpn.vlans: [ *all* ], automatic

groups:
  hosts:
    members: [ h1, h2, h3, h4 ]
    device: linux
  pe:
    members: [ pe1, pe2, pe3 ]
    module: [ bgp, ospf, mpls, vlan, evpn, vrf ]
    # config: [ evpn.mpls ]
  core:
    members: [ p ]
    module: [ ospf, mpls ]  # bgp-free core

nodes: [ pe1, pe2, pe3, p, h1, h2, h3, h4 ]

links:
- pe1-p
- pe2-p
- pe3-p
- pe1:
  h1:
  vlan.access: red
- pe2:
  h2:
  vlan.access: green
- pe3:
  h3:
  h4:
  vlan.access: blue
