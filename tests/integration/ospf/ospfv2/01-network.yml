---
message: |
  This lab tests the OSPF network type and the default device MTU settings. The
  device under test has two interfaces with OSPF network type set to 'broadcast'
  and 'point-to-point'. It has to establish OSPF adjacencies over both and
  propagate OSPF LSAs to enable X1 and X2 to build an end-to-end path.

  The adjacency establishment could fail due to missing OSPF configuration or MTU
  mismatch. A mismatch in network type would result in broken end-to-end path.

defaults.sources.extra: [ ../../wait_times.yml, ../../warnings.yml ]
module: [ ospf ]

groups:
  probes:
    device: frr
    provider: clab
    members: [ x1, x2 ]

nodes:
  dut:
  x1:
  x2:

links:
- dut:
  x1:
  ospf.network_type: broadcast

- dut:
  x2:
  ospf.network_type: point-to-point

validate:
  adj:
    description: Check OSPF adjacencies
    wait_msg: Waiting for OSPF adjacency process to complete
    wait: ospfv2_adj_lan
    nodes: [ x1, x2 ]
    plugin: ospf_neighbor(nodes.dut.ospf.router_id)
  x1_lb:
    description: Check route to X1 on X2
    wait_msg: Waiting for SPF run
    wait: ospfv2_spf
    nodes: [ x2 ]
    plugin: ospf_prefix(nodes.x1.loopback.ipv4)
  x2_lb:
    description: Check route to X2 on X1
    wait_msg: Waiting for SPF run
    wait: ospfv2_spf
    nodes: [ x1 ]
    plugin: ospf_prefix(nodes.x2.loopback.ipv4)
