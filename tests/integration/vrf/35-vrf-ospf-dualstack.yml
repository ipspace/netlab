---
message: |
  This lab tests running both OSPFv2 and OSPFv3 simultaneously inside the same routing instance, both in the base
  routing instance and inside a VRF.

defaults.sources.extra: [ ../wait_times.yml ]
module: [ ospf ]

addressing:
  loopback:
    ipv4: 10.1.0.0/16
    ipv6: 2001:db8:1::/48
  lan:
    ipv4: 10.2.0.0/16
    ipv6: 2001:db8:2::/48
  p2p:
    ipv4: 10.3.0.0/16
    ipv6: 2001:db8:3::/48

vrfs:
  red:
    links: [ dut-x2 ]
    loopback: True

groups:
  probes:
    device: frr
    provider: clab
    members: [ x1, x2 ]

nodes:
  dut:
    module: [ ospf, vrf ]
    vrfs:
      red:
        ospf.router_id: 10.100.0.100
  x1:
  x2:

links:
- dut:
  x1:

validate:
  adj_v2:
    description: Check OSPFv2 adjacencies
    wait_msg: Waiting for OSPF adjacency process to complete
    wait: ospfv2_adj_lan
    nodes: [ x1 ]
    plugin: ospf_neighbor(nodes.dut.ospf.router_id)
 
  adj_v3:
    description: Check OSPFv3 adjacencies
    wait_msg: Waiting for OSPFv3 adjacencies to form
    wait: ospfv3_adj_lan
    nodes: [ x1 ]
    plugin: ospf6_neighbor(nodes.dut.ospf.router_id)
  
  red_adj_v2:
    description: Check OSPFv2 adjacencies in red VRF
    nodes: [ x2 ]
    plugin: ospf_neighbor(nodes.dut.vrfs.red.ospf.router_id)

  red_adj_v3:
    description: Check OSPFv3 adjacencies in red VRF
    nodes: [ x2 ]
    plugin: ospf6_neighbor(nodes.dut.vrfs.red.ospf.router_id)
