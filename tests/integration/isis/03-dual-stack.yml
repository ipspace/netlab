---
message: |
  This lab tests IS-IS in dual-stack deployment. The device under test is a
  level-1-2 IS-IS router with two LAN interfaces connected to adjacent IS-IS
  routers.

module: [ isis ]

defaults.interfaces.mtu: 1500
defaults.sources.extra: [ defaults-ds.yml, ../wait_times.yml, ../warnings.yml ]
defaults.isis.warnings.circuit_type: False

groups:
  probes:
    provider: clab
    members: [ x1, x2, x3 ]

isis.type: level-1-2

nodes:
  dut:
  x1:
  x2:
  x3:

links:
- dut:
  x1:

- dut:
  x2:

- dut:
    isis.type: level-1
  x3:

validate:
  adj:
    description: Check IS-IS adjacencies
    wait_msg: Waiting for IS-IS adjacency process to complete
    wait: isis_adj_p2p
    nodes: [ x1, x2 ]
    plugin: isis_neighbor('dut',level='L1L2')
  adj_x3:
    description: Check the DUT-X3 IS-IS adjacency
    wait_msg: Waiting for IS-IS adjacency process to complete
    wait: isis_adj_p2p
    nodes: [ x3 ]
    plugin: isis_neighbor('dut')
  adj_ct:
    description: Check the level of DUT-X3 IS-IS adjacency
    fail: The IS-IS adjacency is not limited by the circuit type on DUT
    nodes: [ x3 ]
    plugin: isis_neighbor('dut',level='L1')
    level: warning
  pfx_v4:
    description: Check IS-IS IPv4 prefix
    wait_msg: Waiting for IS-IS SPF run
    wait: isis_spf_long
    nodes: [ x1 ]
    plugin: isis_prefix(pfx=nodes.x2.loopback.ipv4,level='1')
  pfx_v6:
    description: Check IS-IS IPv6 prefix
    wait_msg: Waiting for IS-IS SPF run
    wait: isis_spf
    nodes: [ x1 ]
    plugin: isis_prefix(pfx=nodes.x2.loopback.ipv6,af='ipv6',level='2')
  ping_v4:
    description: End-to-end IPv4 connectivity test
    wait_msg: Waiting for IS-IS SPF run
    wait: ping
    nodes: [ x1 ]
    plugin: ping(nodes.x2.loopback.ipv4,src=nodes.x1.loopback.ipv4)
  ping_v6:
    description: End-to-end IPv6 connectivity test
    nodes: [ x1 ]
    plugin: ping(nodes.x2.loopback.ipv6,src=nodes.x1.loopback.ipv6,af='ipv6')
