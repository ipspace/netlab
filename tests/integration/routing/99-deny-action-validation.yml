---
message: |
  Test that 'set' and 'delete' attributes are not allowed with 'action: deny'

plugin: [ bgp.policy ]
module: [ bgp, routing ]

defaults.sources.extra: [ ../wait_times.yml, ../warnings.yml ]

nodes:
  dut:
    device: frr
    bgp.as: 65000
    # This should fail validation - set attribute with deny action
    routing.policy.deny_with_set:
    - action: deny
      match:
        prefix: 192.168.0.0/16
      set:
        community:
          standard: '65000:100'
    # This should also fail validation - delete attribute with deny action
    routing.policy.deny_with_delete:
    - action: deny
      match:
        prefix: 192.168.1.0/16
      delete:
        community:
          standard: '65000:200'
    id: 1

validate:
  # This test should fail during topology validation, so we won't get here
  dummy:
    description: This should not run - validation should fail first
    nodes: [ dut ]
    plugin: >
      bgp_prefix('192.168.0.0/16')
