---
defaults.device: frr
defaults.provider: clab

module: [ ospf, bgp, vrf, vlan, vxlan, evpn ]
plugin: [ files ]
defaults.vrf.warnings.inactive: False

groups:
  core:
    members: [ r2, r5 ]
bgp.as_list:
  65000:
    members: [ r1, r2, r3 ]
  65100:
    members: [ r4, r5, r6 ]
    rr: [ r5 ]

nodes:
  r1:
  r2:
    device: eos
    graph.rank: 1
  r3:
  r4:
  r5:
  r6:
  h1:
    device: linux
  h2:
    device: linux

vrfs:
  tenant:
    evpn.transit_vni: True
    links: [ r1-r4, r3-r6 ]

links:
- interfaces: [ r2, r1 ]
  graph.linkorder: 1
- interfaces: [ r2, r3 ]
  graph.linkorder: 2
- r1-r3
- r4-r5
- r5-r6
- r4-r6
- r1-h1
- r4-h2

files:
  make_dot.sh: |
    netlab graph -t bgp -f rr --title "BGP route reflector sessions" dot-bgp-rr.svg
    netlab graph -t bgp -f vrf --title "Dashed VRF BGP sessions" dot-bgp-vrf.svg
    netlab graph -t bgp -f novrf --title "Global BGP sessions (no VRF sessions)" dot-bgp-novrf.svg
    netlab graph -t bgp -f evpn,rr --title "EVPN BGP sessions" dot-bgp-evpn.svg
  make_d2.sh: |
    unset D2_LAYOUT
    unset D2_SKETCH
    if [[ "$*" == *"elk"* ]]; then
      echo "Using ELK layout engine"
      export D2_LAYOUT=elk
    fi
    if [[ "$*" == *"sketch"* ]]; then
      echo "Using sketch mode"
      export D2_SKETCH=true
    fi

    netlab graph -e d2 -t bgp --title "Default BGP graph" d2-bgp-default.svg
    NETLAB_OUTPUTS_D2_BGP_RR=False \
      netlab graph -e d2 -t bgp --title "BGP graph with no arrows on sessions" d2-bgp-no-rr.svg
    netlab graph -e d2 -t bgp --title "VRF BGP sessions" -f vrf d2-bgp-vrf.svg
    netlab graph -e d2 -t bgp --title "BGP sessions with EVPN AF" -f evpn d2-bgp-evpn.svg
