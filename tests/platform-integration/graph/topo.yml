---
provider: clab
plugin: [ files ]

groups:
  _auto_create: True
  switch:
    device: frr
    members: [ fabric ]
  fabric:
    graph.color: '#ff8080'
    graph.width: 3
    graph.fill: '#ffc0c0'
    bgp.as: 65000
    members: [ s1, s2, l1, l2 ]
  host:
    members: [ h1, h2, h3, h4 ]
    device: linux
  spine:
    members: [ s1, s2 ]
    graph.rank: 1
    graph.format.width: 2
    d2.format:
      width: 250
      height: 70
      shape: rectangle
      style.fill-pattern: grain
  leaf:
    members: [ l1, l2 ]
    graph.rank: 2
  sa_host:
    members: [ h3, h4 ]
    graph.rank: 50

module: [ ospf, bgp ]

links:
- s1-l1
- s1-l2
- s2-l1
- s2:
  l2:
  graph.format.style: dashed
  d2.format.style.stroke-dash: 5
- l1:
  h1:
    graph.linkorder: 200
  h2:
    graph.linkorder: 200
  graph.color: "#FF0000"
  graph.width: 3
  d2.format.shape: oval
- interfaces: [ l2, h3 ]
- interfaces: [ l2, h4 ]
  graph.type: lan

files:
  make_dot.sh: |
    NETLAB_OUTPUTS_GRAPH_NODE__ADDRESS__LABEL=False \
      netlab graph --title "Topology graph, no labels" dot-topo-no-labels.svg
    NETLAB_OUTPUTS_GRAPH_AS__CLUSTERS=False \
      netlab graph --title "Topology graph, no AS clusters" dot-topo-no-clusters.svg
    NETLAB_OUTPUTS_GRAPH_INTERFACE__LABELS=True \
      netlab graph --title "Topology graph, interface labels" dot-topo-intf-labels.svg
    NETLAB_OUTPUTS_GRAPH_GROUPS=[fabric,host] \
      netlab graph --title "Topology graph, custom groups" dot-topo-groups.svg
  make_d2.sh: |
    unset D2_LAYOUT
    unset D2_SKETCH
    if [[ "$*" == *"elk"* ]]; then
      echo "Using ELK layout engine"
      export D2_LAYOUT=elk
    fi
    if [[ "$*" == *"sketch"* ]]; then
      echo "Using sketch mode"
      export D2_SKETCH=true
    fi
    NETLAB_OUTPUTS_D2_NODE__ADDRESS__LABEL=False \
      netlab graph -e d2 --title "Topology graph, no labels" d2-topo-no-labels.svg
    NETLAB_OUTPUTS_D2_AS__CLUSTERS=False \
      netlab graph -e d2 --title "Topology graph, no AS clusters" d2-topo-no-clusters.svg
    NETLAB_OUTPUTS_D2_INTERFACE__LABELS=True \
      netlab graph -e d2 --title "Topology graph, interface labels" d2-topo-intf-labels.svg
    NETLAB_OUTPUTS_D2_GROUPS=[fabric,host] \
      netlab graph -e d2 --title "Topology graph, custom groups" d2-topo-groups.svg
