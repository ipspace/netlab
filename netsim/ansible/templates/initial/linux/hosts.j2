#
# Build hosts file
#
hostname {{ inventory_hostname }}
{% if clab.kind is defined %}
{# ... running in containerlab, have to rewrite /etc/hosts from scratch #}
cat <<HOSTS >/etc/hosts
#
# Created by netlab (containerlab Linux host)
#
127.0.0.1	localhost
::1	localhost ip6-localhost ip6-loopback
fe00::0	ip6-localnet
ff00::0	ip6-mcastprefix
ff02::1	ip6-allnodes
ff02::2	ip6-allrouters
HOSTS
{% endif %}
#
cat <<SCRIPT >/tmp/hosts
#
# Generated by netlab initial
#
127.0.0.1 {{ inventory_hostname }}

{% for k,v in hostvars.items() if k != inventory_hostname and v.af.ipv4|default(False) %}
{%- if v.loopback.ipv4 is defined %}{{ v.loopback.ipv4|ipaddr('address') }} {% endif %}
{%- for l in v.interfaces|default([]) if 'ipv4' in l and l.ipv4 != True and l.ipv4|ipv4 %}{{ l.ipv4|ipaddr('address') }} {% endfor %}{{ k }}
{% endfor %}
SCRIPT
grep "netlab initial" /etc/hosts || uniq /tmp/hosts >>/etc/hosts

