{% from "templates/initial/sros.gnmi.j2" import if_name with context %}

# !
# mpls ip
# !
# mpls ldp
#   router-id {{ ldp.router_id }}
#   transport-address interface Loopback0
#   interface disabled default
#   no shutdown
# {% if ldp.explicit_null|default(False) %}
#   label local-termination explicit-null
# {% endif %}
# !
# interface Loopback0
#   mpls ldp interface
# !
# {% for l in interfaces if ('ldp' in l) and not l.ldp.passive %}
# interface {{ l.ifname }}
#   mpls ip
#   mpls ldp interface
# {% endfor %}
# !

updates:
- path: configure/router[router-name=Base]/ldp
  val:
   admin-state: enable
   implicit-null-label: {{ not ldp.explicit_null|default(False) }}
   interface-parameters:
     interface:
{%   for l in interfaces if ('ldp' in l) and not l.ldp.passive %}
     - ip-int-name: "{{ if_name(l.ifname) }}"
       admin-state: enable
{%     for af in ('ipv4','ipv6') if af in l %}
       {{ af }}:
        admin-state: enable
        transport-address: system
{%     endfor %}
{%   endfor %}
