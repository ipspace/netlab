{% set KW_NETWORK_TYPE = {'point-to-point': 'p2p','point-to-multipoint': 'p2mp', 'non-broadcast': 'nbma' } %}
{% set pid = ospf.process|default(1) %}
protocols {
  delete: ospf;
}
protocols {
  ospf {
{% if ospf.reference_bandwidth is defined %}
    reference-bandwidth {{ ospf.reference_bandwidth * 1000000 }};
{% endif %}
    area {{ ospf.area }} {
      interface lo0;
    }
{% for l in interfaces|default([]) if 'ospf' in l %}
    area {{ l.ospf.area }} {
      interface {{ l.ifname }} {
{%   if l.ospf.network_type is defined and l.ospf.network_type != 'broadcast' %}
        interface-type {{ KW_NETWORK_TYPE[l.ospf.network_type] }};
{%   endif %}
{%   if l.ospf.passive|default(False) %}
        passive;
{%   endif %}
{%   if l.ospf.cost is defined %}
        metric {{ l.ospf.cost }};
{%   endif %}
      }
    }
{% endfor %}
  }
}
