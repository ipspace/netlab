updates:
- path: configure/router[router-name=Base]
  val:
   isis:
   - isis-instance: 0
     admin-state: enable
     area-address: ["{{ isis.net | default( "%s.0000.0000.%04d.00" % (isis.area,id) ) }}"]
     level-capability: "{{ '2' if isis.type=='level-2' else ('1' if isis.type=='level-1' else '1/2') }}"
{%   if isis.ipv6 is defined %}
     multi-topology:
      ipv6-unicast: True
{%   endif %}
{% if isis.loop_free_alternate|default(0) %}
     loopfree-alternate: { }
{% endif %}
     traffic-engineering: {{ isis.traffic_engineering|default(0) }}
     interface:
     - interface-name: "{{ "system" if 'sr' in module else "Loopback0" }}"
       passive: True
{%   for l in links|default([]) %}
{%    if "external" in l.role|default("") %}
     # IS-IS not configured on external interface {{ l.ifname }}
{%    else %}
     - interface-name: i{{ l.ifname }}
       interface-type: {{ 'point-to-point' if l.type|default("") == "p2p" else 'broadcast' }}
       passive: {{ l.type|default("") == "stub" or l.role|default("NONE") in ["stub","passive"] }}
{%     set isis_bfd_v4 = isis.bfd.ipv4 if 'bfd' in isis else False %}
{%     set isis_bfd_v6 = isis.bfd.ipv6 if 'bfd' in isis else False %}
{%     if (l.ipv4|default('')|ipv4 and isis_bfd_v4) or (l.ipv6|default('')|ipv6 and isis_bfd_v6) %}
       bfd-liveness:
{%     if (l.ipv4|default('')|ipv4 and isis_bfd_v4) %}
        ipv4: { }
{%     endif %}
{%     if (l.ipv6|default('')|ipv6 and isis_bfd_v6) %}
        ipv6: { }
{%     endif %}
{%     endif %}
{%     if l.isis.metric is defined or l.isis.cost is defined %}
       level:
       - level-number: 1
         wide-metrics-only: True
         metric: {{ l.isis.metric|default(l.isis.cost) }}
       - level-number: 2
         wide-metrics-only: True
         metric: {{ l.isis.metric|default(l.isis.cost) }}
{%     endif %}
{%    endif %}
{%   endfor %}
