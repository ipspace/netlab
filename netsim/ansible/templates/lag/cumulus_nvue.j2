{% from "initial/cumulus_nvue.j2" import decl_interface with context %}

{% for i in interfaces if i.type == 'lag' %}
{%  if loop.first %}
- set:
    interface:
{%  endif %}
{{      decl_interface(i) }}
        type: bond
        bond:
{%  set _lacp = i.lag.lacp|default(lag.lacp) %}
{%  if _lacp=='slow' %}
          lacp-rate: slow
{%  elif _lacp=='off' or i.lag.mode|default(lag.mode)=="balance-xor" %}
          mode: static
{%  endif %}
          member:
{%  for c in interfaces if c.lag._parentindex|default(False) == i.linkindex %}
            {{ c.ifname }}: {}
{%  endfor %}
{%  if 'ipv4' not in i and 'ipv6' not in i %}
        bridge:
          domain:
            br_default: {}
{%  endif %}
{% endfor %}
