{% macro bfd(ifname,l) %}
{% set isis_bfd_v4 = isis.bfd.ipv4 if 'bfd' in isis else False %}
{% set isis_bfd_v6 = isis.bfd.ipv6 if 'bfd' in isis else False %}
{% if (l.ipv4|default('')|ipv4 and isis_bfd_v4) or (l.ipv6|default('')|ipv6 and isis_bfd_v6) %}
   - interface-name: {{ ifname }}
{%   if l.ipv4|default('')|ipv4 and isis_bfd_v4 %}
     ipv4:
      bfd:
       admin-state: enable
{%   endif %}
{%   if l.ipv6|default('')|ipv6 and isis_bfd_v6 %}
     ipv6:
      bfd:
       admin-state: enable
{%   endif %}
{% endif %}
{% endmacro %}

updates:
- path: configure/router[router-name=Base]
  val:
   interface:
{{ bfd('system' if 'sr' in module else 'Loopback0',loopback) }}
{% for l in links|default([]) %}
{{ bfd('i'+l.ifname,l) }}
{% endfor %}
