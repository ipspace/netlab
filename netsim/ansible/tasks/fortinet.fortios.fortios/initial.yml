---
- name: Configure global attributes
  fortios_system_global:
    vdom: "{{ vdom }}"
    system_global:
      hostname: '{{ inventory_hostname.replace("_","-") }}'

- name: Turn off LLDP on management interface
  fortios_system_interface:
    vdom: "{{ vdom }}"
    state: "present"
    system_interface:
      interface: "port1"
      lldp_reception: "disable"
      lldp_transmission: "disable"
      name: "port1"

- name: Configure loopback interface
  fortios_system_interface:
    vdom: "{{ vdom }}"
    state: "present"
    system_interface:
      alias: "{{ loopback.name | default(omit) }}"
      interface: "loopback0"
      ip: "{{ loopback.ipv4 | default(omit) }}"
      name: "loopback0"
      type: "loopback"
      vdom: "{{ vdom }}"
  when: loopback is defined

- name: Configure loopback ipv6 address
  fortios_system_interface:
    vdom: "{{ vdom }}"
    system_interface:
      interface: "loopback0"
      ipv6:
        ip6_address: "{{ loopback.ipv6 }}"
        ip6_mode: "static"
      name: "loopback0"
      vdom: "{{ vdom }}"
  when: loopback.ipv6 is defined

- name: Configure physical interfaces
  fortios_system_interface:
    vdom: "{{ vdom }}"
    state: "present"
    system_interface:
      alias: "{{ item.name | default(omit) }}"
      estimated_upstream_bandwidth: "{{ item.bandwidth | default(omit) }}"
      estimated_downstream_bandwidth: "{{ item.bandwidth | default(omit) }}"
      interface: "{{ item.ifname }}"
      ip: "{{ item.ipv4 | default(omit) }}"
      lldp_reception: "enable"
      lldp_transmission: "enable"
      mode: "static"
      name: "{{ item.ifname }}"
      macaddr: "52:dc:ca:fe:{{ id }}:{{ item.ifindex }}"
      type: "physical"
      vdom: "{{ vdom }}"
  with_items: "{{ links }}"

- name: Configure loopback ipv6 address
  fortios_system_interface:
    vdom: "{{ vdom }}"
    system_interface:
      interface: "{{ item.ifname }}"
      ipv6:
        ip6_address: "{{ item.ipv6 }}"
        ip6_mode: "static"
      name: "{{ item.ifname }}"
      vdom: "{{ vdom }}"
  with_items: "{{ links }}"
  when: item.ipv6 is defined
