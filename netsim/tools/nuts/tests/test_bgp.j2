{% set ns = namespace(found=false) %}
- test_class: TestNapalmBgpNeighbors
  test_data:
{% for nn,nd in nodes.items() %}
{%   for neighbor in nd.bgp.neighbors %}
{%     if neighbor.ipv4 %}
{%     set ns.found = true %}
    - host: {{ nn }}
      local_id: {{ nd.bgp.router_id }}
      local_as: {{ nd.bgp.as }}
      peer: {{ neighbor.ipv4 }}
      remote_as: {{ neighbor.as }}
      remote_id: {{ nodes[neighbor.name].bgp.router_id }}
      is_enabled: true
      is_up: true
{%     endif %}
{%     if neighbor.ipv6 %}
{%     set ns.found = true %}
    - host: {{ nn }}
      local_id: {{ nd.bgp.router_id }}
      local_as: {{ nd.bgp.as }}
      peer: {{ neighbor.ipv6 }}
      remote_as: {{ neighbor.as }}
      remote_id: {{ nodes[neighbor.name].bgp.router_id }}
      is_enabled: true
      is_up: true
{%     endif %}
{%   endfor %}
{% endfor %}
{% if not ns.found %}
    []  # No BGP tests created
{% endif %}

- test_class: TestNapalmBgpNeighborsCount
  test_data:
{% for nn,nd in nodes.items() if nd.bgp.neighbors %}
    - host: {{ nn }}
      neighbor_count: {{ nd.bgp.neighbors | length }}
{% endfor %}
{% if not ns.found %}
    []  # No BGP tests created
{% endif %}
