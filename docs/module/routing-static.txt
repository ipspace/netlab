(generic-routing-static)=
## Static Routes

Static routes are defined as lists of prefix/next-hop pairs in the **routing.static** node attribute. Each static route entry must specify a prefix and a next hop.

### Platform Support

_netlab_ supports static routes on these platforms:

| Operating system    | Global<br>static routes | Discard<br>routes | VRF static<br>routes | Inter-VRF<br>static routes |
|---------------------|:--:|:--:|:--:|:--:|
| Arista EOS          | ✅ | ✅ | ✅ | ✅ |
| Aruba AOS-CX        | ✅ | ✅ | ✅ | [❗](caveats-aruba) |
| Cisco IOS/XE[^18v]  | ✅ | ✅ | ✅ | ✅ |
| Cisco IOS/XR[^XR]   | ✅ | ✅ | ✅ | ✅ |
| Cumulus Linux 4.x   | ✅ |  ❌ | ✅ | ✅ |
| Dell OS10           | ✅ | ✅ | ✅ | ✅ |
| Junos               | ✅ | ✅ | ✅ | ❌ |
| FRR                 | ✅ | ✅ | ✅ | ✅ |
| Linux               | ✅ |  ❌ |  ❌ |  ❌ |
| VyOS                | ✅ | ✅ | ✅ | ✅ |

### Configuring Static Routes

The static route prefix can be defined with one of these attributes:

* **ipv4**/**ipv6** -- an IPv4 and/or IPv6 prefix
* **pool** -- [address pool](address-pools) prefix
* **prefix** -- a [named prefix](named-prefixes)
* **node** -- a prefix of the specified node's control-plane endpoint (loopback interface or first data-plane interface)

```{tip}
You can combine **‌ipv4** and **‌ipv6** prefixes in the same static route entry. All other attributes are exclusive and can specify both IPv4 and IPv6 prefixes.
```

A static route entry's **nexthop** attribute specifies the next hop used to reach the specified prefixes. The next hop can be defined with any one of these attributes:

* **ipv4**/**ipv6** -- an IPv4 and/or IPv6 next hop (an address, not a prefix)
* **gateway** (boolean) -- the next hop is the default gateway. This entry will be resolved into a list containing all directly connected default gateways in the specified next-hop VRF (a node might use more than one default gateway to reach a destination).
* **node** -- The next hop is the specified node. The node name will be resolved into a list of directly connected next-hops or the control-plane endpoint of a distant node (allowing you to specify recursive static routes).
* **discard** -- The static route is a *discard* (aka *blackhole*) route pointing to the *null* interface (or an equivalent).

```{tip}
* You can combine **‌ipv4** and **‌ipv6** next hops in the same static route entry. **gateway** and **node** next-hop attributes are exclusive and can specify both IPv4 and IPv6 next hops.
* Static route entries with an **‌ipv4** prefix must have an **‌ipv4** next hop (and likewise for **‌ipv6**). _netlab_ does not support IPv6 next hops for IPv4 routes.
* _netlab_ will configure several static routes with different next hops if your topology has multiple direct links between the source and the next-hop node or if a node is attached to multiple links with default gateways.
* Static routes cannot point to unnumbered IPv4 interfaces or LLA-only IPv6 interfaces.
```

For example, the following lab topology generates two static routes on node C for the loopback address of node X, pointing to the directly connected IP addresses of node P:

```
nodes:
  c:
    module: [ routing ]
    routing.static:
    - node: x
      nexthop.node: p
  p:
    module: [ ospf ]
  x:
    module: [ ospf ]

links: [ c-p, c-p, p-x ]
```

After adding the static route for the loopback address of node X, we can add a static default route using that loopback address as the next hop:

```
nodes:
  c:
    module: [ routing ]
    routing.static:
    - node: x
      nexthop.node: p
    - ipv4: 0.0.0.0/0
      nexthop.node: x
  p:
    module: [ ospf ]
  x:
    module: [ ospf ]

links: [ c-p, c-p, p-x ]
```

The following topology will add a default route toward the anycast default gateway:

```
nodes:
  c:
    module: [ routing ]
    routing.static:
    - ipv4: 0.0.0.0/0
      gateway: True
  s1:
    module: [ gateway ]
  s2:
    module: [ gateway ]

links:
- interfaces: [ c, s1, s2 ]
  gateway.protocol: anycast
```

In the following topology, the node C is attached to two interfaces with a default gateway. _netlab_ will configure two static default routes (one per default gateway):

```
nodes:
  c:
    module: [ routing ]
    routing.static:
    - ipv4: 0.0.0.0/0
      gateway: True
  s1:
    module: [ gateway ]
  s2:
    module: [ gateway ]

links:
- interfaces: [ c, s1, s2 ]
  gateway.protocol: anycast
- interfaces: [ c, s1, s2 ]
  gateway.protocol: anycast
```

### VRF Static Routes

You can specify the **vrf** attribute in a static route entry to create a VRF static route. The lack of a **vrf** attribute indicates a static route in the global routing table (sometimes called *default VRF*).

You can also specify the **vrf** attribute in the next-hop definition to create an inter-VRF static route. Use the **nexthop.vrf** attribute with no value (`null`) to create a VRF static route with a next hop in the global routing table.

### Global Static Routes

You can define global static routes in the **routing.static** topology attribute. The definition of global static routes is a dictionary of static route lists, allowing you to include a subset of global static routes into individual nodes.

To include a global static route list into the node static routes, use the **include** attribute in a node static route entry. For example, you could use the following definitions to include the default routes pointing to node X into node C:

```
routing.static:
  default:
  - ipv4: 0.0.0.0/0
    ipv6: ::/0
    nexthop.node: x

module: [ ospf ]

nodes:
  c:
    module: [ routing,ospf ]
    routing.static:
    - include: default
  p:
  x:

links: [ c-p, p-x ]
```

You can override the next hop of the included static routes with the **nexthop** attribute specified in the **include** entry. For example, you can change the next hop of the default route on the C router to point to the upstream P router:

```
routing.static:
  default:
  - ipv4: 0.0.0.0/0
    ipv6: ::/0
    nexthop.node: x

module: [ ospf ]

nodes:
  c:
    module: [ routing ]
    routing.static:
    - include: default
      nexthop.node: p
  p:
  x:

links: [ c-p, p-x ]
```
